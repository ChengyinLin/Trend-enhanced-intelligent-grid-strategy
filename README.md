# Trend-enhanced-intelligent-grid-strategy--V2.0
趋势增强型智能网格策略 v2.0 - 优化版
基于股票历史数据回测优化

优化要点：
1. 动态网格间距：基于ATR波动率自适应调整
2. 趋势评分系统：多时间框架均线排列+动量
3. 智能仓位管理：趋势增强+波动率调整
4. 止损冷却机制：止损后20日冷却+自动重启
5. 趋势跟踪加仓：强趋势突破时追加仓位
6. 成交量过滤：低于均量60%不买入

【原始策略问题诊断】
--------------------------------------------------------------------------------
   基于603993(2020-2025)数据回测发现：
1. 单边上涨行情(2020-2021)：网格策略过早卖出，错失主升浪
2. 震荡行情(2022-2023)：网格交易频繁，但收益有限
3. 快速下跌时：止损机制不完善，回撤较大
4. 固定网格间距：无法适应不同波动率环境

【核心优化措施】
--------------------------------------------------------------------------------

1. 动态网格间距
   方法: 基于ATR波动率自适应调整
   效果: 高波动时扩大网格(避免频繁交易)，低波动时缩小网格(提高成交效率)

2. 趋势评分系统
   方法: 多时间框架均线排列+动量+RSI
   效果: 识别单边趋势，在强上涨趋势中减少卖出，在下跌趋势中减少买入

3. 智能仓位管理
   方法: 基础仓位×趋势因子×波动率调整
   效果: 强趋势时增加仓位，高波动时降低仓位，控制单次风险暴露

4. 止损冷却机制
   方法: 15%最大回撤止损+20日冷却期
   效果: 防止连续止损，冷却期后自动重新初始化网格

5. 趋势跟踪加仓
   方法: 趋势强度>0.7且突破20日高点时加仓
   效果: 在确认上涨趋势后追加仓位，分享趋势收益

6. 成交量过滤
   方法: 低于20日均量60%时不买入
   效果: 避免流动性不足时的无效交易，提高成交质量

| 优化点      | 原始策略 | 优化后策略            |
| -------- | ---- | ---------------- |
| **网格间距** | 固定2% | ATR动态调整(1.5%-6%) |
| **趋势判断** | 无    | 多时间框架均线+RSI评分    |
| **仓位管理** | 固定比例 | 趋势增强×波动率调整       |
| **止损机制** | 简单止损 | 15%回撤+20日冷却+自动重启 |
| **加仓逻辑** | 无    | 趋势突破加仓           |
| **成交过滤** | 无    | 成交量<60%均量不买入     |


📊 生成的可视化图表
1. comprehensive_strategy_analysis.png - 综合策略分析（大图）
包含10个子图：

主图：策略净值 vs 买入持有对比

交易信号：股票价格与买卖点标记（买入△/卖出▽/止损×/加仓★/减仓◇）

持仓比例：仓位分配随时间变化

现金储备：现金余额变化

趋势指标：-1到1的趋势强度评分

RSI指标：14日相对强弱指数

回撤分析：最大回撤24.51%标记

成交量：交易量分布

盈亏分布：每笔交易盈亏（胜率100%）

交易统计：买卖/止损/加仓/减仓次数

<img width="3280" height="3954" alt="comprehensive_strategy_analysis" src="https://github.com/user-attachments/assets/ce9355b8-6a36-447a-b238-cc11fbc6c0e5" />

2. supplementary_analysis.png - 补充分析
包含4个子图：

月度收益热力图：2020-2026年各月收益率分布

滚动收益波动率：60日滚动年化收益与波动率

交易效率：持仓时间与收益率关系

相关性分析：策略与买入持有的滚动相关性

<img width="3175" height="2376" alt="supplementary_analysis" src="https://github.com/user-attachments/assets/c1e873d2-d1f2-4dc7-995f-613900da9e18" />

3. strategy_mechanism.png - 策略原理演示
包含4个子图：

网格机制：典型网格交易买卖示意图

动态间距：静态网格 vs ATR动态网格对比

趋势评分：多因子趋势计算逻辑

优化对比：原始策略与优化策略的5项指标对比

<img width="3177" height="2379" alt="strategy_mechanism" src="https://github.com/user-attachments/assets/884e3a85-a998-47ec-8e8c-9cae54e9d4cc" />

📈 关键发现
| 指标       | 优化策略    | 买入持有    |
| -------- | ------- | ------- |
| **总收益率** | 40.72%  | 377.83% |
| **最大回撤** | 24.51%  | ~50%    |
| **夏普比率** | 0.35    | ~0.8    |
| **胜率**   | 100%    | -       |
| **交易频率** | 14.9次/年 | -       |

结论：优化后的网格策略在单边上涨行情中大幅跑输买入持有，但在风险控制（回撤24.51% vs 50%）和交易胜率（100%）方面表现优异，更适合震荡市或作为风险对冲工具使用。

开始生成可视化图表...
======================================================================
1. 加载数据...
   数据点数: 1473
   时间范围: 2020-01-20 00:00:00 至 2026-02-13 00:00:00

2. 运行策略回测...
   回测天数: 1453
   交易次数: 89

3. 生成可视化图表...
✅ 综合分析图表已生成
✅ 补充分析图表已生成
✅ 策略原理图已生成

4. 生成绩效报告...
总收益率:         40.72%
年化收益:          5.89%
最大回撤:         24.51%
夏普比率:           0.35
交易次数:             89


【策略适用性分析】
--------------------------------------------------------------------------------
✅ 适用场景：
   - 震荡行情（网格交易优势）
   - 波动率较高的市场（动态网格有效）
   - 无法判断方向的结构性行情（趋势过滤）
   - 风险厌恶型投资者（回撤控制）

❌ 不适用场景：
   - 强单边上涨行情（如2020-2021年的603993）
   - 流动性极差的市场（成交量过滤会阻止交易）
   - 极速下跌行情（15%止损可能来不及）
   - 追求高收益的投资者（收益上限受限）


如何获取股票的CSV数据：（可参照我的飞书云文档链接）！！
https://my.feishu.cn/wiki/WJ3UwK6HNiymaSk7DgVcI02lnog?from=from_copylink

下载Anaconda链接：https://www.anaconda.com/download

下载VScode链接：https://code.visualstudio.com/
